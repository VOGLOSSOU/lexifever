<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simple - Lexifever</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">üß™ Test Simple API</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Test direct de l'API</h2>
            
            <div class="space-y-4">
                <div>
                    <strong>URL de base:</strong> <span id="api-url"></span>
                </div>
                
                <button id="test-fetch" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
                    Test Fetch Direct
                </button>
                
                <div id="result" class="mt-4 p-4 bg-gray-50 rounded"></div>
            </div>
        </div>
    </div>

    <script>
        // Configuration API
        const API_BASE_URL = window.location.origin + '/api';
        document.getElementById('api-url').textContent = API_BASE_URL;
        
        console.log('üåê API Base URL:', API_BASE_URL);
        console.log('üè† Window origin:', window.location.origin);
        
        document.getElementById('test-fetch').addEventListener('click', async () => {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="text-blue-600">Test en cours...</div>';
            
            try {
                console.log('üöÄ Test fetch vers:', API_BASE_URL + '/health');
                
                const response = await fetch(API_BASE_URL + '/health');
                console.log('üì° R√©ponse:', response);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ Donn√©es:', data);
                
                resultDiv.innerHTML = `
                    <div class="text-green-600">
                        <h3 class="font-bold">‚úÖ Succ√®s !</h3>
                        <pre class="mt-2 text-sm bg-white p-2 rounded border">${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
                
                // Test g√©n√©ration
                console.log('üéØ Test g√©n√©ration...');
                const generateResponse = await fetch(API_BASE_URL + '/generate-text', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        domain: 'Technologie',
                        topic: 'Intelligence Artificielle',
                        level: 'intermediate',
                        tone: 'conversational'
                    })
                });
                
                if (!generateResponse.ok) {
                    throw new Error(`G√©n√©ration failed: ${generateResponse.status}`);
                }
                
                const generateData = await generateResponse.json();
                console.log('‚úÖ G√©n√©ration r√©ussie:', generateData);
                
                resultDiv.innerHTML += `
                    <div class="text-green-600 mt-4">
                        <h3 class="font-bold">‚úÖ G√©n√©ration r√©ussie !</h3>
                        <p class="mt-2 text-sm bg-white p-2 rounded border">
                            ${generateData.data.englishText.substring(0, 200)}...
                        </p>
                    </div>
                `;
                
            } catch (error) {
                console.error('‚ùå Erreur:', error);
                resultDiv.innerHTML = `
                    <div class="text-red-600">
                        <h3 class="font-bold">‚ùå Erreur</h3>
                        <p class="mt-2">${error.message}</p>
                        <pre class="mt-2 text-sm bg-white p-2 rounded border">${error.stack}</pre>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
